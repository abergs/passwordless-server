@page "/credentials/user/{userid}"
@model UserModel

@{
  ViewData["Title"] = "Home page";
}

<div class="text-centerc">
  <h1>User Details</h1>
  <p>This pages summarizes the information for user <span class="badge bg-dark">@Model.UserId</span></p>

  <div>
    <h2>Credentials</h2>
    @if(Model.Credentials.Count == 0) {
    <p>No credentials registered for this user</p>
    }
    <div class="credential-wrapper">      
      @foreach (var cred in Model.Credentials)
      {
        <div class="credential">
            <h2 class="text-center">@(cred.Device)</h2>
            <h6 class="text-center">@(cred.Nickname ?? "No nickname")</h6>

            <div>
            <span class="strong">UserId: </span><span>@cred.UserId</span><br/>            
            <span class="strong">Created:</span><span>@cred.CreatedAt</span><br />
            <span class="strong">Last used: </span><span>@cred.LastUsedAt</span>
            </div>
            <hr>
            <div class="mt-3">
              <h6>Details</h6>              
            </div>

            <div>
                <span class="strong">Credential Id: </span><small class="font-monospace">@cred.Descriptor.Id.ToBase64Url()</small><br />
                <div class="mt-2"></div>
                <span class="strong">Public Key: </span><small class="text-break font-monospace">@cred.PublicKey.ToBase64Url()</small><br/>
                <hr>
                <span class="strong">Type: </span><small class="text-break font-monospace">@cred.CredType</small><br />
                <span class="strong">Counter: </span><small class="text-break font-monospace">@cred.SignatureCounter</small><br />
                <span class="strong">RPID: </span><small class="text-break font-monospace">@cred.RPID</small><br />
                <span class="strong">Origin: </span><small class="text-break font-monospace">@cred.Origin</small><br />
                <span class="strong">AaGuid: </span><small class="text-break font-monospace">@cred.AaGuid</small><br />

            </div>

            <a
              asp-page="Delete"
              asp-route-userid="@Model.UserId"
              asp-route-credentialId="@cred.Descriptor.Id.ToBase64Url()"
              type="button" class="mt-3 btn btn-sm btn-primary">Remove</a>
          </div>
      }      
    </div>
    <div>      
      <h2 class="mt-3">Alias</h2>
      <p>Aliases are hashed and cannot be read once they are written.</p>
      <div class="aliases">
        <ul>
          <li>anders@passwordless.dev - <i class="bi bi-trash3 link-danger"></i></li>
          <li>aaberg@bitwarden.com - <i class="bi bi-trash3 link-danger"></i></li>
          <li>anders - <i class="bi bi-trash3 link-danger"></i></li>
        </ul>
      </div>
    </div>

    <div>
      <h2 class="mt-3">Audit logs</h2>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Timestamp</th>
            <th scope="col">Level</th>
            <th scope="col">Message</th>
          </tr>
        </thead>
        <tbody>
          @foreach (var log in Model.AuditLogs)
          {
            <tr>
              <th scope="row">@log.Timestamp</th>
              <td><span class="badge bg-@log.Level">@log.Level</span></td>
              <td>@log.Message</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  <h5 class="mt-5">Todo</h5>
  <ul> <li>Allow a tenant to disable hashing</li>
          <li>Allow to list all aliases</li>
          <li>Allow to add one without removing all</li></ul>
<style>
  .credential-wrapper {
    display: grid;
      grid-template-columns: 1fr 1fr 1fr;
  }

  .credential {
    background: #eee;
    padding: 15px;
    border-radius: 6px;
  }
</style>